<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PhotonMap</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Elem3D.html"><span class="hs-identifier">Elem3D</span></a></span><span>
</span><span id="line-6"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier">Foton</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>      </span><span class="annot"><a href="Elem3D.html#Luz"><span class="hs-identifier">Luz</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>      </span><span class="annot"><a href="Elem3D.html#RGB"><span class="hs-identifier">RGB</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>      </span><span class="annot"><a href="Elem3D.html#Ray"><span class="hs-identifier">Ray</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>      </span><span class="annot"><a href="Elem3D.html#Point3D"><span class="hs-identifier">Point3D</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>      </span><span class="annot"><a href="Elem3D.html#movePoint"><span class="hs-identifier">movePoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>      </span><span class="annot"><a href="Elem3D.html#%23%3C"><span class="hs-operator">(#&lt;)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>      </span><span class="annot"><a href="Elem3D.html#%23"><span class="hs-operator">(#)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>      </span><span class="annot"><a href="Elem3D.html#pointDir"><span class="hs-identifier">pointDir</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>      </span><span class="annot"><a href="Elem3D.html#pointToPothon"><span class="hs-identifier">pointToPothon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>      </span><span class="annot"><a href="Elem3D.html#.%2A"><span class="hs-operator">(.*)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>      </span><span class="annot"><a href="Elem3D.html#modd"><span class="hs-identifier">modd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>      </span><span class="annot"><a href="Elem3D.html#normal"><span class="hs-identifier">normal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>      </span><span class="annot"><a href="Elem3D.html#modRGB"><span class="hs-identifier">modRGB</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>      </span><span class="annot"><a href="Elem3D.html#scale"><span class="hs-identifier">scale</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>      </span><span class="annot"><a href="Elem3D.html#addPoints"><span class="hs-identifier">addPoints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>      </span><span class="annot"><a href="Elem3D.html#escalatePoint"><span class="hs-identifier">escalatePoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elem3D.html#Direction"><span class="hs-identifier">Direction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elem3D.html#Direction"><span class="hs-identifier">Direction</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elem3D.html#distFot"><span class="hs-identifier">distFot</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Figuras.html"><span class="hs-identifier">Figuras</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Figuras.html#getShapeID"><span class="hs-identifier">getShapeID</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>      </span><span class="annot"><a href="Figuras.html#oneCollision"><span class="hs-identifier">oneCollision</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>      </span><span class="annot"><a href="Figuras.html#Obj"><span class="hs-identifier">Obj</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>      </span><span class="annot"><a href="Figuras.html#Shape"><span class="hs-identifier">Shape</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Figuras.html#Triangle"><span class="hs-identifier">Triangle</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>      </span><span class="annot"><a href="Figuras.html#Triangulo"><span class="hs-identifier">Triangulo</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Figuras.html#Triangulo"><span class="hs-identifier">Triangulo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Random</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StdGen</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">split</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Funciones.html"><span class="hs-identifier">Funciones</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Funciones.html#objAleatorio"><span class="hs-identifier">objAleatorio</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>      </span><span class="annot"><a href="Funciones.html#objEspejo"><span class="hs-identifier">objEspejo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>      </span><span class="annot"><a href="Funciones.html#objCristal"><span class="hs-identifier">objCristal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>      </span><span class="annot"><a href="Funciones.html#mediaRGB"><span class="hs-identifier">mediaRGB</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>      </span><span class="annot"><a href="Funciones.html#sumRGB"><span class="hs-identifier">sumRGB</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>      </span><span class="annot"><a href="Funciones.html#genPoint"><span class="hs-identifier">genPoint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>      </span><span class="annot"><a href="Funciones.html#genPointTotal"><span class="hs-identifier">genPointTotal</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>      </span><span class="annot"><a href="Funciones.html#obtenerPrimeraColision"><span class="hs-identifier">obtenerPrimeraColision</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>      </span><span class="annot"><a href="Funciones.html#colision"><span class="hs-identifier">colision</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>      </span><span class="annot"><a href="Funciones.html#brdf"><span class="hs-identifier">brdf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Funciones.html#sumRGB"><span class="hs-identifier">sumRGB</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Funciones.html#ruletaRusa"><span class="hs-identifier">ruletaRusa</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>      </span><span class="annot"><a href="Funciones.html#objEspejoRandom"><span class="hs-identifier">objEspejoRandom</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Funciones.html#media"><span class="hs-identifier">media</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Funciones.html#desviacionEstandar"><span class="hs-identifier">desviacionEstandar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Funciones.html#fGaus"><span class="hs-identifier">fGaus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Funciones.html#addNiebla"><span class="hs-identifier">addNiebla</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Funciones.html#dirEspejo"><span class="hs-identifier">dirEspejo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">trace</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.DList</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DL</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.KdTree.Static</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">kNearest</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">KdTree</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">inRadius</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">nearest</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.DList</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DL</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="annot"><a href="PhotonMap.html#createPhoton"><span class="hs-identifier hs-type">createPhoton</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DL.DList</span></span><span> </span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier hs-type">Foton</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="Figuras.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elem3D.html#Luz"><span class="hs-identifier hs-type">Luz</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DL.DList</span></span><span> </span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier hs-type">Foton</span></a></span><span>
</span><span id="line-50"></span><span id="createPhoton"><span class="annot"><span class="annottext">createPhoton :: Float
-&gt; DList Foton
-&gt; Int
-&gt; Int
-&gt; Set Shape
-&gt; [Luz]
-&gt; StdGen
-&gt; Int
-&gt; DList Foton
</span><a href="PhotonMap.html#createPhoton"><span class="hs-identifier hs-var hs-var">createPhoton</span></a></span></span><span> </span><span id="local-6989586621679078312"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078312"><span class="hs-identifier hs-var">lzT</span></a></span></span><span> </span><span id="local-6989586621679078311"><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078311"><span class="hs-identifier hs-var">fotones</span></a></span></span><span> </span><span id="local-6989586621679078310"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078310"><span class="hs-identifier hs-var">contador</span></a></span></span><span> </span><span id="local-6989586621679078309"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078309"><span class="hs-identifier hs-var">contMx</span></a></span></span><span> </span><span id="local-6989586621679078308"><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078308"><span class="hs-identifier hs-var">figuras</span></a></span></span><span> </span><span id="local-6989586621679078307"><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078307"><span class="hs-identifier hs-var">luces</span></a></span></span><span> </span><span id="local-6989586621679078306"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078306"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621679078305"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078305"><span class="hs-identifier hs-var">nRebotes</span></a></span></span><span>
</span><span id="line-51"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078310"><span class="hs-identifier hs-var">contador</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078309"><span class="hs-identifier hs-var">contMx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078311"><span class="hs-identifier hs-var">fotones</span></a></span><span> </span><span class="hs-comment">-- Devuelve la lista de fotones</span><span>
</span><span id="line-52"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078310"><span class="hs-identifier hs-var">contador</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078309"><span class="hs-identifier hs-var">contMx</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">`div`</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Int
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078312"><span class="hs-identifier hs-var">lzT</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078301"><span class="hs-identifier hs-var">intLuz</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
-&gt; DList Foton
-&gt; Int
-&gt; Int
-&gt; Set Shape
-&gt; [Luz]
-&gt; StdGen
-&gt; Int
-&gt; DList Foton
</span><a href="PhotonMap.html#createPhoton"><span class="hs-identifier hs-var">createPhoton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078312"><span class="hs-identifier hs-var">lzT</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078301"><span class="hs-identifier hs-var">intLuz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078311"><span class="hs-identifier hs-var">fotones</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078310"><span class="hs-identifier hs-var">contador</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078309"><span class="hs-identifier hs-var">contMx</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078308"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Luz] -&gt; [Luz]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078307"><span class="hs-identifier hs-var">luces</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078298"><span class="hs-identifier hs-var">gen'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078305"><span class="hs-identifier hs-var">nRebotes</span></a></span><span> </span><span class="hs-comment">-- Cambio de luz</span><span>
</span><span id="line-53"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float
-&gt; DList Foton
-&gt; Int
-&gt; Int
-&gt; Set Shape
-&gt; [Luz]
-&gt; StdGen
-&gt; Int
-&gt; DList Foton
</span><a href="PhotonMap.html#createPhoton"><span class="hs-identifier hs-var">createPhoton</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078312"><span class="hs-identifier hs-var">lzT</span></a></span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078297"><span class="hs-identifier hs-var">newlisP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078310"><span class="hs-identifier hs-var">contador</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078309"><span class="hs-identifier hs-var">contMx</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078308"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078307"><span class="hs-identifier hs-var">luces</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078298"><span class="hs-identifier hs-var">gen'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078305"><span class="hs-identifier hs-var">nRebotes</span></a></span><span> </span><span class="hs-comment">-- Se vuelve a llamar con la nueva lista de fotones</span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679078296"><span class="annot"><span class="annottext">Ray
</span><a href="#local-6989586621679078296"><span class="hs-identifier hs-var">ray</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elem3D.html#Luz"><span class="hs-identifier hs-type">Luz</span></a></span><span> </span><span id="local-6989586621679078294"><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078294"><span class="hs-identifier hs-var">pointPapa</span></a></span></span><span> </span><span id="local-6989586621679078293"><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078293"><span class="hs-identifier hs-var">rgbPadre</span></a></span></span><span> </span><span id="local-6989586621679078301"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078301"><span class="hs-identifier hs-var">intLuz</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Luz] -&gt; Int -&gt; Int -&gt; StdGen -&gt; (Ray, Luz)
</span><a href="PhotonMap.html#selescLightSource"><span class="hs-identifier hs-var">selescLightSource</span></a></span><span> </span><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078307"><span class="hs-identifier hs-var">luces</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078310"><span class="hs-identifier hs-var">contador</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078309"><span class="hs-identifier hs-var">contMx</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078306"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679078297"><span class="annot"><span class="annottext">newlisP :: DList Foton
</span><a href="#local-6989586621679078297"><span class="hs-identifier hs-var hs-var">newlisP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point3D
-&gt; Float
-&gt; RGB
-&gt; DList Foton
-&gt; Set Shape
-&gt; Int
-&gt; StdGen
-&gt; Obj
-&gt; DList Foton
</span><a href="PhotonMap.html#traceRay"><span class="hs-identifier hs-var">traceRay</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078294"><span class="hs-identifier hs-var">pointPapa</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">4.0</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Float
forall a. Floating a =&gt; a
</span><span class="hs-identifier hs-var">pi</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078301"><span class="hs-identifier hs-var">intLuz</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Float
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078309"><span class="hs-identifier hs-var">contMx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078293"><span class="hs-identifier hs-var">rgbPadre</span></a></span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078311"><span class="hs-identifier hs-var">fotones</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078308"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078305"><span class="hs-identifier hs-var">nRebotes</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078298"><span class="hs-identifier hs-var">gen'</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078280"><span class="hs-identifier hs-var">nxtObj</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621679078280"><span class="annot"><span class="annottext">nxtObj :: Obj
</span><a href="#local-6989586621679078280"><span class="hs-identifier hs-var hs-var">nxtObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Obj -&gt; Obj
</span><a href="Funciones.html#obtenerPrimeraColision"><span class="hs-identifier hs-var">obtenerPrimeraColision</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Obj -&gt; Obj) -&gt; Set Obj -&gt; Obj
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Shape -&gt; Obj) -&gt; Set Shape -&gt; Set Obj
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679078276"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621679078276"><span class="hs-identifier hs-var">figura</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Shape -&gt; Ray -&gt; Obj
</span><a href="Figuras.html#oneCollision"><span class="hs-identifier hs-var">oneCollision</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621679078276"><span class="hs-identifier hs-var">figura</span></a></span><span> </span><span class="annot"><span class="annottext">Ray
</span><a href="#local-6989586621679078296"><span class="hs-identifier hs-var">ray</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078308"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="hs-comment">-- Siguiente objeto que choca</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621679078298"><span class="annot"><span class="annottext">gen' :: StdGen
</span><a href="#local-6989586621679078298"><span class="hs-identifier hs-var hs-var">gen'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen, StdGen) -&gt; StdGen
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((StdGen, StdGen) -&gt; StdGen) -&gt; (StdGen, StdGen) -&gt; StdGen
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; (StdGen, StdGen)
forall g. RandomGen g =&gt; g -&gt; (g, g)
</span><span class="hs-identifier hs-var">split</span></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078306"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="PhotonMap.html#selescLightSource"><span class="hs-pragma hs-type">selescLightSource</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-62"></span><span class="annot"><a href="PhotonMap.html#selescLightSource"><span class="hs-identifier hs-type">selescLightSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elem3D.html#Luz"><span class="hs-identifier hs-type">Luz</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Elem3D.html#Ray"><span class="hs-identifier hs-type">Ray</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Elem3D.html#Luz"><span class="hs-identifier hs-type">Luz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span id="selescLightSource"><span class="annot"><span class="annottext">selescLightSource :: [Luz] -&gt; Int -&gt; Int -&gt; StdGen -&gt; (Ray, Luz)
</span><a href="PhotonMap.html#selescLightSource"><span class="hs-identifier hs-var hs-var">selescLightSource</span></a></span></span><span> </span><span id="local-6989586621679078273"><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078273"><span class="hs-identifier hs-var">luces</span></a></span></span><span> </span><span id="local-6989586621679078272"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078272"><span class="hs-identifier hs-var">contador</span></a></span></span><span> </span><span id="local-6989586621679078271"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078271"><span class="hs-identifier hs-var">contMx</span></a></span></span><span> </span><span id="local-6989586621679078270"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078270"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point3D -&gt; Direction -&gt; Ray
</span><a href="Elem3D.html#Ray"><span class="hs-identifier hs-var">Ray</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078268"><span class="hs-identifier hs-var">pLuz</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Point3D -&gt; Point3D
</span><a href="Elem3D.html#movePoint"><span class="hs-identifier hs-var">movePoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point3D -&gt; Direction
</span><a href="Elem3D.html#pointDir"><span class="hs-identifier hs-var">pointDir</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078268"><span class="hs-identifier hs-var">pLuz</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StdGen -&gt; Point3D
</span><a href="Funciones.html#genPointTotal"><span class="hs-identifier hs-var">genPointTotal</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078270"><span class="hs-identifier hs-var">gen</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point3D -&gt; Point3D -&gt; Direction
</span><a href="Elem3D.html#%23%3C"><span class="hs-operator hs-var">#&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078268"><span class="hs-identifier hs-var">pLuz</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Luz
</span><a href="#local-6989586621679078267"><span class="hs-identifier hs-var">luz</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621679078267"><span class="annot"><span class="annottext">luz :: Luz
</span><a href="#local-6989586621679078267"><span class="hs-identifier hs-var">luz</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Elem3D.html#Luz"><span class="hs-identifier hs-type">Luz</span></a></span><span> </span><span id="local-6989586621679078268"><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078268"><span class="hs-identifier hs-var">pLuz</span></a></span></span><span> </span><span class="annot"><span class="annottext">RGB
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Luz] -&gt; Luz
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078273"><span class="hs-identifier hs-var">luces</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><a href="PhotonMap.html#traceRay"><span class="hs-identifier hs-type">traceRay</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Elem3D.html#Point3D"><span class="hs-identifier hs-type">Point3D</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elem3D.html#RGB"><span class="hs-identifier hs-type">RGB</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DL.DList</span></span><span> </span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier hs-type">Foton</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="Figuras.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StdGen</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Figuras.html#Obj"><span class="hs-identifier hs-type">Obj</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DL.DList</span></span><span> </span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier hs-type">Foton</span></a></span><span>
</span><span id="line-68"></span><span id="traceRay"><span class="annot"><span class="annottext">traceRay :: Point3D
-&gt; Float
-&gt; RGB
-&gt; DList Foton
-&gt; Set Shape
-&gt; Int
-&gt; StdGen
-&gt; Obj
-&gt; DList Foton
</span><a href="PhotonMap.html#traceRay"><span class="hs-identifier hs-var hs-var">traceRay</span></a></span></span><span> </span><span id="local-6989586621679078265"><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078265"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679078264"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078264"><span class="hs-identifier hs-var">pot</span></a></span></span><span> </span><span id="local-6989586621679078263"><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078263"><span class="hs-identifier hs-var">rgb</span></a></span></span><span> </span><span id="local-6989586621679078262"><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078262"><span class="hs-identifier hs-var">fotones</span></a></span></span><span> </span><span id="local-6989586621679078261"><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span></span><span> </span><span id="local-6989586621679078260"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078260"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679078259"><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078259"><span class="hs-identifier hs-var">gen</span></a></span></span><span> </span><span id="local-6989586621679078258"><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078260"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078263"><span class="hs-identifier hs-var">rgb</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#RGB"><span class="hs-identifier hs-var">RGB</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078262"><span class="hs-identifier hs-var">fotones</span></a></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078255"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679078255"><span class="annot"><span class="annottext">result :: DList Foton
</span><a href="#local-6989586621679078255"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078248"><span class="hs-identifier hs-var">caso</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078247"><span class="hs-identifier hs-var">photonD</span></a></span><span> </span><span class="hs-comment">-- Difuso</span><span>
</span><span id="line-74"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078246"><span class="hs-identifier hs-var">photonR</span></a></span><span> </span><span class="hs-comment">--Refracci&#243;n</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078245"><span class="hs-identifier hs-var">photonE</span></a></span><span> </span><span class="hs-comment">-- Especular</span><span>
</span><span id="line-76"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078262"><span class="hs-identifier hs-var">fotones</span></a></span><span> </span><span class="hs-comment">-- Absorci&#243;n</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span>    </span><span id="local-6989586621679078244"><span class="annot"><span class="annottext">pObj :: Point3D
</span><a href="#local-6989586621679078244"><span class="hs-identifier hs-var hs-var">pObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; Point3D
</span><a href="Figuras.html#colObj"><span class="hs-identifier hs-var hs-var">colObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621679078242"><span class="annot"><span class="annottext">nObj :: Direction
</span><a href="#local-6989586621679078242"><span class="hs-identifier hs-var hs-var">nObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#normObj"><span class="hs-identifier hs-var hs-var">normObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679078248"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078248"><span class="hs-identifier hs-var">caso</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679078240"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078240"><span class="hs-identifier hs-var">por</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Float, Float, Float) -&gt; StdGen -&gt; (Int, Float)
</span><a href="Funciones.html#ruletaRusa"><span class="hs-identifier hs-var">ruletaRusa</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; (Float, Float, Float)
</span><a href="Figuras.html#trObj"><span class="hs-identifier hs-var hs-var">trObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078259"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621679078247"><span class="annot"><span class="annottext">photonD :: DList Foton
</span><a href="#local-6989586621679078247"><span class="hs-identifier hs-var hs-var">photonD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point3D
-&gt; Float
-&gt; RGB
-&gt; DList Foton
-&gt; Set Shape
-&gt; Int
-&gt; StdGen
-&gt; Obj
-&gt; DList Foton
</span><a href="PhotonMap.html#traceRay"><span class="hs-identifier hs-var">traceRay</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078244"><span class="hs-identifier hs-var">pObj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">2</span></span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Float
forall a. Floating a =&gt; a
</span><span class="hs-identifier hs-var">pi</span></span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078229"><span class="hs-identifier hs-var">pot'</span></a></span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078240"><span class="hs-identifier hs-var">por</span></a></span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#w0Obj"><span class="hs-identifier hs-var hs-var">w0Obj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078226"><span class="hs-identifier hs-var">nxtObj</span></a></span><span> </span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; Float
</span><a href="Elem3D.html#.%2A"><span class="hs-operator hs-var">.*</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621679078242"><span class="hs-identifier hs-var">nObj</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Set Shape -&gt; RGB
</span><a href="Funciones.html#brdf"><span class="hs-identifier hs-var">brdf</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#modRGB"><span class="hs-operator hs-var">`modRGB`</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">255</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078262"><span class="hs-identifier hs-var">fotones</span></a></span><span> </span><span class="annot"><span class="annottext">DList Foton -&gt; Foton -&gt; DList Foton
forall a. DList a -&gt; a -&gt; DList a
</span><span class="hs-operator hs-var">`DL.snoc`</span></span><span> </span><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078224"><span class="hs-identifier hs-var">foton</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078260"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078223"><span class="hs-identifier hs-var">gen'</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078226"><span class="hs-identifier hs-var">nxtObj</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679078245"><span class="annot"><span class="annottext">photonE :: DList Foton
</span><a href="#local-6989586621679078245"><span class="hs-identifier hs-var hs-var">photonE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point3D
-&gt; Float
-&gt; RGB
-&gt; DList Foton
-&gt; Set Shape
-&gt; Int
-&gt; StdGen
-&gt; Obj
-&gt; DList Foton
</span><a href="PhotonMap.html#traceRay"><span class="hs-identifier hs-var">traceRay</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078244"><span class="hs-identifier hs-var">pObj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078264"><span class="hs-identifier hs-var">pot</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078240"><span class="hs-identifier hs-var">por</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Set Shape -&gt; RGB
</span><a href="Funciones.html#brdf"><span class="hs-identifier hs-var">brdf</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB -&gt; RGB
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078263"><span class="hs-identifier hs-var">rgb</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078262"><span class="hs-identifier hs-var">fotones</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078260"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078223"><span class="hs-identifier hs-var">gen'</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078220"><span class="hs-identifier hs-var">objEsp</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span id="local-6989586621679078246"><span class="annot"><span class="annottext">photonR :: DList Foton
</span><a href="#local-6989586621679078246"><span class="hs-identifier hs-var hs-var">photonR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point3D
-&gt; Float
-&gt; RGB
-&gt; DList Foton
-&gt; Set Shape
-&gt; Int
-&gt; StdGen
-&gt; Obj
-&gt; DList Foton
</span><a href="PhotonMap.html#traceRay"><span class="hs-identifier hs-var">traceRay</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078244"><span class="hs-identifier hs-var">pObj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078264"><span class="hs-identifier hs-var">pot</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078240"><span class="hs-identifier hs-var">por</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Set Shape -&gt; RGB
</span><a href="Funciones.html#brdf"><span class="hs-identifier hs-var">brdf</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB -&gt; RGB
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078263"><span class="hs-identifier hs-var">rgb</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DList Foton
</span><a href="#local-6989586621679078262"><span class="hs-identifier hs-var">fotones</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679078260"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078223"><span class="hs-identifier hs-var">gen'</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078217"><span class="hs-identifier hs-var">objCri</span></a></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span>    </span><span id="local-6989586621679078224"><span class="annot"><span class="annottext">foton :: Foton
</span><a href="#local-6989586621679078224"><span class="hs-identifier hs-var hs-var">foton</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Point3D -&gt; Float -&gt; RGB -&gt; Int -&gt; Foton
</span><a href="Elem3D.html#Foton"><span class="hs-identifier hs-var">Foton</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078244"><span class="hs-identifier hs-var">pObj</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078229"><span class="hs-identifier hs-var">pot'</span></a></span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078263"><span class="hs-identifier hs-var">rgb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Int
</span><a href="Figuras.html#idObj"><span class="hs-identifier hs-var hs-var">idObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621679078229"><span class="annot"><span class="annottext">pot' :: Float
</span><a href="#local-6989586621679078229"><span class="hs-identifier hs-var hs-var">pot'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#w0Obj"><span class="hs-identifier hs-var hs-var">w0Obj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Direction -&gt; Direction -&gt; Float
</span><a href="Elem3D.html#.%2A"><span class="hs-operator hs-var">.*</span></a></span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621679078242"><span class="hs-identifier hs-var">nObj</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078264"><span class="hs-identifier hs-var">pot</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1</span></span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="hs-special">(</span><span class="annot"><span class="annottext">Direction -&gt; Float
</span><a href="Elem3D.html#modd"><span class="hs-identifier hs-var">modd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Point3D
</span><a href="Figuras.html#colObj"><span class="hs-identifier hs-var hs-var">colObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D -&gt; Point3D -&gt; Direction
</span><a href="Elem3D.html#%23%3C"><span class="hs-operator hs-var">#&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078265"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">10.0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Floating a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">**</span></span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>    </span><span>
</span><span id="line-89"></span><span>    </span><span id="local-6989586621679078226"><span class="annot"><span class="annottext">nxtObj :: Obj
</span><a href="#local-6989586621679078226"><span class="hs-identifier hs-var hs-var">nxtObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Shape -&gt; Obj -&gt; StdGen -&gt; Obj
</span><a href="Funciones.html#objAleatorio"><span class="hs-identifier hs-var">objAleatorio</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078204"><span class="hs-identifier hs-var">figuras'</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078259"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="hs-comment">-- Siguiente objeto que choca con direcci&#243;n random</span><span>
</span><span id="line-90"></span><span>    </span><span id="local-6989586621679078220"><span class="annot"><span class="annottext">objEsp :: Obj
</span><a href="#local-6989586621679078220"><span class="hs-identifier hs-var hs-var">objEsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Shape -&gt; Direction -&gt; Direction -&gt; Point3D -&gt; Obj
</span><a href="Funciones.html#objEspejo"><span class="hs-identifier hs-var">objEspejo</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078204"><span class="hs-identifier hs-var">figuras'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#w0Obj"><span class="hs-identifier hs-var hs-var">w0Obj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621679078242"><span class="hs-identifier hs-var">nObj</span></a></span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078244"><span class="hs-identifier hs-var">pObj</span></a></span><span> </span><span class="hs-comment">-- Siguiente objeto que choca con direcci&#243;n espejo</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679078217"><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078217"><span class="hs-identifier hs-var">objCri</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Shape
-&gt; Direction
-&gt; Direction
-&gt; Float
-&gt; Float
-&gt; Point3D
-&gt; (Obj, Float)
</span><a href="Funciones.html#objCristal"><span class="hs-identifier hs-var">objCristal</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#w0Obj"><span class="hs-identifier hs-var hs-var">w0Obj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Direction
</span><a href="#local-6989586621679078242"><span class="hs-identifier hs-var">nObj</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Float
</span><a href="Figuras.html#reflObj"><span class="hs-identifier hs-var hs-var">reflObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Point3D
</span><a href="#local-6989586621679078244"><span class="hs-identifier hs-var">pObj</span></a></span><span> </span><span class="hs-comment">-- Siguiente objeto que choca con direcci&#243;n refracci&#243;n</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>    </span><span id="local-6989586621679078204"><span class="annot"><span class="annottext">figuras' :: Set Shape
</span><a href="#local-6989586621679078204"><span class="hs-identifier hs-var hs-var">figuras'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Shape -&gt; Bool) -&gt; Set Shape -&gt; Set Shape
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679078200"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621679078200"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; Int
</span><a href="Figuras.html#idObj"><span class="hs-identifier hs-var hs-var">idObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078258"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; Int
</span><a href="Figuras.html#getShapeID"><span class="hs-identifier hs-var">getShapeID</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621679078200"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078261"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="hs-comment">-- Quita el objeto que choca de la lista de figuras para que al buscar la primera vez no choque consigo mismo</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621679078223"><span class="annot"><span class="annottext">gen' :: StdGen
</span><a href="#local-6989586621679078223"><span class="hs-identifier hs-var hs-var">gen'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(StdGen, StdGen) -&gt; StdGen
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((StdGen, StdGen) -&gt; StdGen) -&gt; (StdGen, StdGen) -&gt; StdGen
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StdGen -&gt; (StdGen, StdGen)
forall g. RandomGen g =&gt; g -&gt; (g, g)
</span><span class="hs-identifier hs-var">split</span></span><span> </span><span class="annot"><span class="annottext">StdGen
</span><a href="#local-6989586621679078259"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="PhotonMap.html#estDensPhoton"><span class="hs-pragma hs-type">estDensPhoton</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-98"></span><span class="annot"><a href="PhotonMap.html#estDensPhoton"><span class="hs-identifier hs-type">estDensPhoton</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier hs-type">Foton</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Figuras.html#Obj"><span class="hs-identifier hs-type">Obj</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="Figuras.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elem3D.html#RGB"><span class="hs-identifier hs-type">RGB</span></a></span><span>
</span><span id="line-99"></span><span id="estDensPhoton"><span class="annot"><span class="annottext">estDensPhoton :: [Foton] -&gt; Obj -&gt; Set Shape -&gt; Float -&gt; RGB
</span><a href="PhotonMap.html#estDensPhoton"><span class="hs-identifier hs-var hs-var">estDensPhoton</span></a></span></span><span> </span><span id="local-6989586621679078196"><span class="annot"><span class="annottext">[Foton]
</span><a href="#local-6989586621679078196"><span class="hs-identifier hs-var">photons</span></a></span></span><span> </span><span id="local-6989586621679078195"><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078195"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span id="local-6989586621679078194"><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078194"><span class="hs-identifier hs-var">figuras</span></a></span></span><span> </span><span id="local-6989586621679078193"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078193"><span class="hs-identifier hs-var">radio</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078192"><span class="hs-identifier hs-var">newRGB</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-101"></span><span>   </span><span class="hs-comment">-- newRGB = sumRGB $ map (\photon -&gt; fusion obj (fGaus photons obj photon) photon) photons</span><span>
</span><span id="line-102"></span><span>   </span><span class="hs-comment">-- newRGB = sumRGB $ map (\photon -&gt; fusion obj (1/(radio * radio * pi)) photon) photons</span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621679078192"><span class="annot"><span class="annottext">newRGB :: RGB
</span><a href="#local-6989586621679078192"><span class="hs-identifier hs-var hs-var">newRGB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RGB] -&gt; RGB
</span><a href="Funciones.html#sumRGB"><span class="hs-identifier hs-var">sumRGB</span></a></span><span> </span><span class="annot"><span class="annottext">([RGB] -&gt; RGB) -&gt; [RGB] -&gt; RGB
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Foton -&gt; RGB) -&gt; [Foton] -&gt; [RGB]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679078187"><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078187"><span class="hs-identifier hs-var">photon</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; Float -&gt; Foton -&gt; RGB
</span><a href="#local-6989586621679078186"><span class="hs-identifier hs-var">fusion</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078195"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Point3D -&gt; Foton -&gt; Float
</span><a href="Elem3D.html#distFot"><span class="hs-identifier hs-var">distFot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Point3D
</span><a href="Figuras.html#colObj"><span class="hs-identifier hs-var hs-var">colObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078195"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078187"><span class="hs-identifier hs-var">photon</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078187"><span class="hs-identifier hs-var">photon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Foton]
</span><a href="#local-6989586621679078196"><span class="hs-identifier hs-var">photons</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="#local-6989586621679078186"><span class="hs-identifier hs-type">fusion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Figuras.html#Obj"><span class="hs-identifier hs-type">Obj</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier hs-type">Foton</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elem3D.html#RGB"><span class="hs-identifier hs-type">RGB</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621679078186"><span class="annot"><span class="annottext">fusion :: Obj -&gt; Float -&gt; Foton -&gt; RGB
</span><a href="#local-6989586621679078186"><span class="hs-identifier hs-var hs-var">fusion</span></a></span></span><span> </span><span id="local-6989586621679078185"><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078185"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span id="local-6989586621679078184"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078184"><span class="hs-identifier hs-var">kernel</span></a></span></span><span> </span><span id="local-6989586621679078183"><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078183"><span class="hs-identifier hs-var">fot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078182"><span class="hs-identifier hs-var">newRGB</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#modRGB"><span class="hs-operator hs-var">`modRGB`</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078184"><span class="hs-identifier hs-var">kernel</span></a></span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>        </span><span id="local-6989586621679078182"><span class="annot"><span class="annottext">newRGB :: RGB
</span><a href="#local-6989586621679078182"><span class="hs-identifier hs-var hs-var">newRGB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RGB -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#modRGB"><span class="hs-identifier hs-var">modRGB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RGB -&gt; RGB
</span><a href="Elem3D.html#scale"><span class="hs-identifier hs-var">scale</span></a></span><span> </span><span class="annot"><span class="annottext">(RGB -&gt; RGB) -&gt; RGB -&gt; RGB
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Foton -&gt; RGB
</span><a href="Elem3D.html#rgbFot"><span class="hs-identifier hs-var hs-var">rgbFot</span></a></span><span> </span><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078183"><span class="hs-identifier hs-var">fot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Foton -&gt; Float
</span><a href="Elem3D.html#iFot"><span class="hs-identifier hs-var hs-var">iFot</span></a></span><span> </span><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078183"><span class="hs-identifier hs-var">fot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB -&gt; RGB
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Obj -&gt; Set Shape -&gt; RGB
</span><a href="Funciones.html#brdf"><span class="hs-identifier hs-var">brdf</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078185"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078194"><span class="hs-identifier hs-var">figuras</span></a></span><span>
</span><span id="line-108"></span><span>        </span><span>
</span><span id="line-109"></span><span class="hs-comment">-- photonMap :: KdTree Float Foton -&gt; Int -&gt; Set.Set Shape-&gt; Obj -&gt; RGB</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- photonMap kdt nPhoton figuras obj@(Obj rgb w0 p norm (kd,0,0) kr' id) = newRGB * RGB 255 255 255</span><span>
</span><span id="line-111"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-112"></span><span class="hs-comment">--     !newRGB = kdToRGB kdt (round $ fromIntegral nPhoton * kd) figuras obj</span><span>
</span><span id="line-113"></span><span class="hs-comment">--     figuras' = filter (\shape -&gt; id /= getShapeID shape) figuras</span><span>
</span><span id="line-114"></span><span class="hs-comment">--     objEsp = objEspejo figuras' w0 norm p</span><span>
</span><span id="line-115"></span><span class="hs-comment">--     (objCri,_) = objCristal figuras' w0 norm 1 kr' p</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-comment">-- photonMap kdt nPhoton figuras obj@(Obj rgb w0 p norm (kd,kr,ke) kr' id) = newRGB</span><span>
</span><span id="line-118"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-119"></span><span class="hs-comment">--     !newRGB = kdToRGB kdt (round $ fromIntegral nPhoton * kd) figuras obj + (rgb * scale colorEsp) + rgb * scale colorCri</span><span>
</span><span id="line-120"></span><span class="hs-comment">--     figuras' = filter (\shape -&gt; id /= getShapeID shape) figuras</span><span>
</span><span id="line-121"></span><span class="hs-comment">--     objEsp = objEspejo figuras' w0 norm p</span><span>
</span><span id="line-122"></span><span class="hs-comment">--     (objCri,_) = objCristal figuras' w0 norm 1 kr' p</span><span>
</span><span id="line-123"></span><span class="hs-comment">--     colorCri = if round (fromIntegral nPhoton * kr) == 0 then RGB 0 0 0 else photonMap kdt (round $ fromIntegral nPhoton * kr) figuras objCri --Fixear :D</span><span>
</span><span id="line-124"></span><span class="hs-comment">--     colorEsp = if round (fromIntegral nPhoton * ke) == 0 then RGB 0 0 0 else photonMap kdt (round $ fromIntegral nPhoton * ke) figuras objEsp</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- kdToRGB :: KdTree Float Foton -&gt; Int -&gt; Set.Set Shape-&gt; Obj -&gt; RGB</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- kdToRGB kdt 0 figuras obj@(Obj rgb w0 p norm (kd,kr,ke) kr' id) = RGB 0 0 0</span><span>
</span><span id="line-129"></span><span class="hs-comment">-- kdToRGB kdt nPhoton figuras obj@(Obj rgb w0 p norm (kd,kr,ke) kr' id) = newRGB</span><span>
</span><span id="line-130"></span><span class="hs-comment">--   where</span><span>
</span><span id="line-131"></span><span class="hs-comment">--     photons = kNearest kdt nPhoton (pointToPothon p)</span><span>
</span><span id="line-132"></span><span class="hs-comment">--     photons' = filter (\(Foton point int dir rgbF idF) -&gt; id == idF) photons</span><span>
</span><span id="line-133"></span><span class="hs-comment">--     -- Coger solo fotones del mismo objeto</span><span>
</span><span id="line-134"></span><span class="hs-comment">--     !newRGB = estDensPhoton photons' obj figuras</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="PhotonMap.html#photonMap"><span class="hs-identifier hs-type">photonMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KdTree</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier hs-type">Foton</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Elem3D.html#Luz"><span class="hs-identifier hs-type">Luz</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="Figuras.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Figuras.html#Obj"><span class="hs-identifier hs-type">Obj</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elem3D.html#RGB"><span class="hs-identifier hs-type">RGB</span></a></span><span>
</span><span id="line-138"></span><span id="photonMap"><span class="annot"><span class="annottext">photonMap :: KdTree Float Foton -&gt; [Luz] -&gt; Float -&gt; Set Shape -&gt; Obj -&gt; RGB
</span><a href="PhotonMap.html#photonMap"><span class="hs-identifier hs-var hs-var">photonMap</span></a></span></span><span> </span><span id="local-6989586621679078177"><span class="annot"><span class="annottext">KdTree Float Foton
</span><a href="#local-6989586621679078177"><span class="hs-identifier hs-var">kdt</span></a></span></span><span> </span><span id="local-6989586621679078176"><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078176"><span class="hs-identifier hs-var">luces</span></a></span></span><span> </span><span id="local-6989586621679078175"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078175"><span class="hs-identifier hs-var">radio</span></a></span></span><span> </span><span id="local-6989586621679078174"><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078174"><span class="hs-identifier hs-var">figuras</span></a></span></span><span> </span><span id="local-6989586621679078173"><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; Float
</span><a href="Figuras.html#mindObj"><span class="hs-identifier hs-var hs-var">mindObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#RGB"><span class="hs-identifier hs-var">RGB</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">{- addNiebla (head luces) obj 0.9 figuras $ -}</span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078170"><span class="hs-identifier hs-var">difuso</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB -&gt; RGB
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078169"><span class="hs-identifier hs-var">espejo</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB -&gt; RGB
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078168"><span class="hs-identifier hs-var">cristal</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>    </span><span id="local-6989586621679078170"><span class="annot"><span class="annottext">difuso :: RGB
</span><a href="#local-6989586621679078170"><span class="hs-identifier hs-var hs-var">difuso</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078164"><span class="hs-identifier hs-var">kd</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#RGB"><span class="hs-identifier hs-var">RGB</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">KdTree Float Foton -&gt; Float -&gt; Set Shape -&gt; Obj -&gt; RGB
</span><a href="PhotonMap.html#kdToRGB"><span class="hs-identifier hs-var">kdToRGB</span></a></span><span> </span><span class="annot"><span class="annottext">KdTree Float Foton
</span><a href="#local-6989586621679078177"><span class="hs-identifier hs-var">kdt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078175"><span class="hs-identifier hs-var">radio</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078164"><span class="hs-identifier hs-var">kd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078174"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621679078169"><span class="annot"><span class="annottext">espejo :: RGB
</span><a href="#local-6989586621679078169"><span class="hs-identifier hs-var hs-var">espejo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078159"><span class="hs-identifier hs-var">ke</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#RGB"><span class="hs-identifier hs-var">RGB</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; RGB
</span><a href="Figuras.html#rgbObj"><span class="hs-identifier hs-var hs-var">rgbObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB -&gt; RGB
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB
</span><a href="Elem3D.html#scale"><span class="hs-identifier hs-var">scale</span></a></span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078157"><span class="hs-identifier hs-var">colorEsp</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#modRGB"><span class="hs-operator hs-var">`modRGB`</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078159"><span class="hs-identifier hs-var">ke</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span id="local-6989586621679078168"><span class="annot"><span class="annottext">cristal :: RGB
</span><a href="#local-6989586621679078168"><span class="hs-identifier hs-var hs-var">cristal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078153"><span class="hs-identifier hs-var">kr</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#RGB"><span class="hs-identifier hs-var">RGB</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; RGB
</span><a href="Figuras.html#rgbObj"><span class="hs-identifier hs-var hs-var">rgbObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB -&gt; RGB
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; RGB
</span><a href="Elem3D.html#scale"><span class="hs-identifier hs-var">scale</span></a></span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078152"><span class="hs-identifier hs-var">colorCri</span></a></span><span> </span><span class="annot"><span class="annottext">RGB -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#modRGB"><span class="hs-operator hs-var">`modRGB`</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078153"><span class="hs-identifier hs-var">kr</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679078164"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078164"><span class="hs-identifier hs-var">kd</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679078153"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078153"><span class="hs-identifier hs-var">kr</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679078159"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078159"><span class="hs-identifier hs-var">ke</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; (Float, Float, Float)
</span><a href="Figuras.html#trObj"><span class="hs-identifier hs-var hs-var">trObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679078150"><span class="annot"><span class="annottext">figuras' :: Set Shape
</span><a href="#local-6989586621679078150"><span class="hs-identifier hs-var hs-var">figuras'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Shape -&gt; Bool) -&gt; Set Shape -&gt; Set Shape
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679078149"><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621679078149"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; Int
</span><a href="Figuras.html#idObj"><span class="hs-identifier hs-var hs-var">idObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Shape -&gt; Int
</span><a href="Figuras.html#getShapeID"><span class="hs-identifier hs-var">getShapeID</span></a></span><span> </span><span class="annot"><span class="annottext">Shape
</span><a href="#local-6989586621679078149"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078174"><span class="hs-identifier hs-var">figuras</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621679078148"><span class="annot"><span class="annottext">objEsp :: Obj
</span><a href="#local-6989586621679078148"><span class="hs-identifier hs-var hs-var">objEsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Shape -&gt; Direction -&gt; Direction -&gt; Point3D -&gt; Obj
</span><a href="Funciones.html#objEspejo"><span class="hs-identifier hs-var">objEspejo</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078150"><span class="hs-identifier hs-var">figuras'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#w0Obj"><span class="hs-identifier hs-var hs-var">w0Obj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#normObj"><span class="hs-identifier hs-var hs-var">normObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Point3D
</span><a href="Figuras.html#colObj"><span class="hs-identifier hs-var hs-var">colObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679078147"><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078147"><span class="hs-identifier hs-var">objCri</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Float
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Shape
-&gt; Direction
-&gt; Direction
-&gt; Float
-&gt; Float
-&gt; Point3D
-&gt; (Obj, Float)
</span><a href="Funciones.html#objCristal"><span class="hs-identifier hs-var">objCristal</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078150"><span class="hs-identifier hs-var">figuras'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#w0Obj"><span class="hs-identifier hs-var hs-var">w0Obj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Direction
</span><a href="Figuras.html#normObj"><span class="hs-identifier hs-var hs-var">normObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Float
</span><a href="Figuras.html#reflObj"><span class="hs-identifier hs-var hs-var">reflObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Point3D
</span><a href="Figuras.html#colObj"><span class="hs-identifier hs-var hs-var">colObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078173"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679078152"><span class="annot"><span class="annottext">colorCri :: RGB
</span><a href="#local-6989586621679078152"><span class="hs-identifier hs-var hs-var">colorCri</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KdTree Float Foton -&gt; [Luz] -&gt; Float -&gt; Set Shape -&gt; Obj -&gt; RGB
</span><a href="PhotonMap.html#photonMap"><span class="hs-identifier hs-var">photonMap</span></a></span><span> </span><span class="annot"><span class="annottext">KdTree Float Foton
</span><a href="#local-6989586621679078177"><span class="hs-identifier hs-var">kdt</span></a></span><span> </span><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078176"><span class="hs-identifier hs-var">luces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078175"><span class="hs-identifier hs-var">radio</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078153"><span class="hs-identifier hs-var">kr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078174"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078147"><span class="hs-identifier hs-var">objCri</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679078157"><span class="annot"><span class="annottext">colorEsp :: RGB
</span><a href="#local-6989586621679078157"><span class="hs-identifier hs-var hs-var">colorEsp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KdTree Float Foton -&gt; [Luz] -&gt; Float -&gt; Set Shape -&gt; Obj -&gt; RGB
</span><a href="PhotonMap.html#photonMap"><span class="hs-identifier hs-var">photonMap</span></a></span><span> </span><span class="annot"><span class="annottext">KdTree Float Foton
</span><a href="#local-6989586621679078177"><span class="hs-identifier hs-var">kdt</span></a></span><span> </span><span class="annot"><span class="annottext">[Luz]
</span><a href="#local-6989586621679078176"><span class="hs-identifier hs-var">luces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078175"><span class="hs-identifier hs-var">radio</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078159"><span class="hs-identifier hs-var">ke</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078174"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078148"><span class="hs-identifier hs-var">objEsp</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="annot"><a href="PhotonMap.html#kdToRGB"><span class="hs-identifier hs-type">kdToRGB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KdTree</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="annot"><a href="Elem3D.html#Foton"><span class="hs-identifier hs-type">Foton</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Float</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="Figuras.html#Shape"><span class="hs-identifier hs-type">Shape</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Figuras.html#Obj"><span class="hs-identifier hs-type">Obj</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Elem3D.html#RGB"><span class="hs-identifier hs-type">RGB</span></a></span><span>
</span><span id="line-157"></span><span id="kdToRGB"><span class="annot"><span class="annottext">kdToRGB :: KdTree Float Foton -&gt; Float -&gt; Set Shape -&gt; Obj -&gt; RGB
</span><a href="PhotonMap.html#kdToRGB"><span class="hs-identifier hs-var hs-var">kdToRGB</span></a></span></span><span> </span><span id="local-6989586621679078144"><span class="annot"><span class="annottext">KdTree Float Foton
</span><a href="#local-6989586621679078144"><span class="hs-identifier hs-var">kdt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span id="local-6989586621679078143"><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078143"><span class="hs-identifier hs-var">figuras</span></a></span></span><span> </span><span id="local-6989586621679078142"><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078142"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#RGB"><span class="hs-identifier hs-var">RGB</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span>
</span><span id="line-158"></span><span class="annot"><a href="PhotonMap.html#kdToRGB"><span class="hs-identifier hs-var">kdToRGB</span></a></span><span> </span><span id="local-6989586621679078141"><span class="annot"><span class="annottext">KdTree Float Foton
</span><a href="#local-6989586621679078141"><span class="hs-identifier hs-var">kdt</span></a></span></span><span> </span><span id="local-6989586621679078140"><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078140"><span class="hs-identifier hs-var">radio</span></a></span></span><span> </span><span id="local-6989586621679078139"><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078139"><span class="hs-identifier hs-var">figuras</span></a></span></span><span> </span><span id="local-6989586621679078138"><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078138"><span class="hs-identifier hs-var">obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RGB
</span><a href="#local-6989586621679078137"><span class="hs-identifier hs-var">newRGB</span></a></span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679078134"><span class="annot"><span class="annottext">photons :: [Foton]
</span><a href="#local-6989586621679078134"><span class="hs-identifier hs-var hs-var">photons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KdTree Float Foton -&gt; Float -&gt; Foton -&gt; [Foton]
forall a p. Real a =&gt; KdTree a p -&gt; a -&gt; p -&gt; [p]
</span><span class="hs-identifier hs-var">inRadius</span></span><span> </span><span class="annot"><span class="annottext">KdTree Float Foton
</span><a href="#local-6989586621679078141"><span class="hs-identifier hs-var">kdt</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078140"><span class="hs-identifier hs-var">radio</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Point3D -&gt; Foton
</span><a href="Elem3D.html#pointToPothon"><span class="hs-identifier hs-var">pointToPothon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Obj -&gt; Point3D
</span><a href="Figuras.html#colObj"><span class="hs-identifier hs-var hs-var">colObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078138"><span class="hs-identifier hs-var">obj</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- photons = kNearest kdt (round radio) (pointToPothon (colObj obj)) -- Si quisieramos coger los k-fotones m&#225;s cercanos</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679078132"><span class="annot"><span class="annottext">photons' :: [Foton]
</span><a href="#local-6989586621679078132"><span class="hs-identifier hs-var hs-var">photons'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Foton -&gt; Bool) -&gt; [Foton] -&gt; [Foton]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679078131"><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078131"><span class="hs-identifier hs-var">fot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Obj -&gt; Int
</span><a href="Figuras.html#idObj"><span class="hs-identifier hs-var hs-var">idObj</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078138"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Foton -&gt; Int
</span><a href="Elem3D.html#idFot"><span class="hs-identifier hs-var hs-var">idFot</span></a></span><span> </span><span class="annot"><span class="annottext">Foton
</span><a href="#local-6989586621679078131"><span class="hs-identifier hs-var">fot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Foton]
</span><a href="#local-6989586621679078134"><span class="hs-identifier hs-var">photons</span></a></span><span> </span><span class="hs-comment">-- Coger solo fotones del mismo objeto</span><span>
</span><span id="line-164"></span><span>    </span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679078137"><span class="annot"><span class="annottext">newRGB :: RGB
</span><a href="#local-6989586621679078137"><span class="hs-identifier hs-var hs-var">newRGB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Foton] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Foton]
</span><a href="#local-6989586621679078132"><span class="hs-identifier hs-var">photons'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#RGB"><span class="hs-identifier hs-var">RGB</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078140"><span class="hs-identifier hs-var">radio</span></a></span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0.05</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Float -&gt; Float -&gt; Float -&gt; RGB
</span><a href="Elem3D.html#RGB"><span class="hs-identifier hs-var">RGB</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Float
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Foton] -&gt; Obj -&gt; Set Shape -&gt; Float -&gt; RGB
</span><a href="PhotonMap.html#estDensPhoton"><span class="hs-identifier hs-var">estDensPhoton</span></a></span><span> </span><span class="annot"><span class="annottext">[Foton]
</span><a href="#local-6989586621679078132"><span class="hs-identifier hs-var">photons'</span></a></span><span> </span><span class="annot"><span class="annottext">Obj
</span><a href="#local-6989586621679078138"><span class="hs-identifier hs-var">obj</span></a></span><span> </span><span class="annot"><span class="annottext">Set Shape
</span><a href="#local-6989586621679078139"><span class="hs-identifier hs-var">figuras</span></a></span><span> </span><span class="annot"><span class="annottext">Float
</span><a href="#local-6989586621679078140"><span class="hs-identifier hs-var">radio</span></a></span><span> </span><span class="hs-comment">--Si no hay fotones el color es 0, sino ecuaci&#243;n de estiamcion de densidad</span></pre></body></html>